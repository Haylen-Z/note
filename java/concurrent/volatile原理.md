# volatile原理

每个java线程都有一个属于自己的工作内存（如机器的寄存器），线程对变量进行访问时，会把变量从主内存加载到工作内存再进行访问。线程对工作内存中的变量进行操作后，再刷回主内存。线程执行lock操作时，会从主内存中读取变量的值，更新工作内存；执行unlock时会把工作内存中的变量刷回主内存。

在单线程环境下，这种方式访问变量没有什么问题。但在多线程环境下对共享变量的操作，会导致一个线程对共享变量的更改不能马上对另一个线程可见，会出现数据的不一致。使用volatile修饰的变量，线程每次使用都从主内存读取，并且修改变量时及时地将新值刷新到主内存；volatile还能防止被指令重排序（利用内存屏障）。

